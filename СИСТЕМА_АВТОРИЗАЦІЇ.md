# üîê –°–ò–°–¢–ï–ú–ê –ê–í–¢–û–†–ò–ó–ê–¶–Ü–á - –î–û–ö–£–ú–ï–ù–¢–ê–¶–Ü–Ø

## üìã –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º–∏

### –†—ñ–≤–Ω—ñ –∑–∞—Ö–∏—Å—Ç—É:

1. **Google OAuth** (Supabase Auth)
2. **Email Whitelist** (constants.ts)
3. **–ü–∞—Ä–æ–ª—å —Ä–æ–ª—ñ** (—Ç—ñ–ª—å–∫–∏ –¥–ª—è bukhhalteriya.html)

---

## üö™ –í–•–Ü–î (index.html)

**–§–∞–π–ª:** `src/ts/vxid/login.ts`

### –Ø–∫ –ø—Ä–∞—Ü—é—î:

1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞—Ç–∏—Å–∫–∞—î –∫–Ω–æ–ø–∫—É "–í—Ö—ñ–¥"
2. –í—ñ–¥–∫—Ä–∏–≤–∞—î—Ç—å—Å—è Google OAuth
3. –ü—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ –≤—Ö–æ–¥—É:
   - –ü–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è email –≤ whitelist (constants.ts)
   - –Ø–∫—â–æ –û–ö ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/STO/main.html`
   - –Ø–∫—â–æ –ù–Ü ‚Üí –≤–∏—Ö—ñ–¥ –∑ —Å–∏—Å—Ç–µ–º–∏ + –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è

### Whitelist:

```typescript
// constants.ts
export const ALLOWED_EMAILS = ["veron3373v@gmail.com", "bsbraclavec@gmail.com"];
```

---

## üè† –ì–û–õ–û–í–ù–ê –°–¢–û–†–Ü–ù–ö–ê (main.html)

**–§–∞–π–ª:** `src/ts/roboha/main_session_guard.ts`

### –ó–∞—Ö–∏—Å—Ç:

- –ü–µ—Ä–µ–≤—ñ—Ä—è—î –Ω–∞—è–≤–Ω—ñ—Å—Ç—å Google —Å–µ—Å—ñ—ó
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î email –≤ whitelist
- –Ø–∫—â–æ –ù–ï –û–ö ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ index.html

---

## üìÖ –ü–õ–ê–ù–£–í–ê–ù–ù–Ø (planyvannya.html)

**–§–∞–π–ª:** `src/ts/roboha/planyvannya/planyvannya_auth_guard.ts`

### –ó–∞—Ö–∏—Å—Ç:

- –ë–ª–æ–∫—É—é—á–∏–π inline —Å–∫—Ä–∏–ø—Ç –≤ `<head>` (–ø–µ—Ä–µ–≤—ñ—Ä—è—î –î–û —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥—É)
- –î–æ–¥–∞—Ç–∫–æ–≤–∏–π guard –ø—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
- –°—Ç–æ—Ä—ñ–Ω–∫–∞ –ø—Ä–∏—Ö–æ–≤–∞–Ω–∞ (`opacity: 0`) –¥–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É
- URL –æ–±—Ñ—É—Å–∫–∞—Ü—ñ—è –ø—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ—ó –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó

### CSS –∑–∞—Ö–∏—Å—Ç:

```css
body {
  opacity: 0;
  transition: opacity 0.15s ease-in;
}
body.auth-verified {
  opacity: 1;
}
```

---

## üí∞ –ë–£–•–ì–ê–õ–¢–ï–†–Ü–Ø (bukhhalteriya.html)

**–§–∞–π–ª:** `src/ts/roboha/bukhhalteriya/bukhhalteriya_session_guard.ts`

### –ó–∞—Ö–∏—Å—Ç (2 —Ä—ñ–≤–Ω—ñ):

1. **Google —Å–µ—Å—ñ—è** - –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è –≤ session_guard.ts
2. **–ü–∞—Ä–æ–ª—å —Ä–æ–ª—ñ** - –º–æ–¥–∞–ª–∫–∞ –∑ users.ts

### –Ø–∫ –ø—Ä–∞—Ü—é—î:

1. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ Google —Å–µ—Å—ñ—ó + whitelist
2. –Ø–∫—â–æ –û–ö ‚Üí –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è –º–æ–¥–∞–ª–∫–∞ –≤–≤–µ–¥–µ–Ω–Ω—è –ø–∞—Ä–æ–ª—è
3. –ü–∞—Ä–æ–ª—å –≤–∏–∑–Ω–∞—á–∞—î —Ä–æ–ª—å: –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä, –°–ª—é—Å–∞—Ä, –ó–∞–ø—á–∞—Å—Ç–∏—Å—Ç —Ç–æ—â–æ
4. –î–æ—Å—Ç—É–ø –¥–æ —Ñ—É–Ω–∫—Ü—ñ–π –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ —Ä–æ–ª—ñ

### –ö–æ–¥ –≤ users.ts:

```typescript
export async function showLoginModalBeforeTable(): Promise<string | null> {
  // 1. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ Google —Å–µ—Å—ñ—ó
  const {
    data: { session },
  } = await supabase.auth.getSession();

  if (!session) {
    window.location.href = "/STO/index.html";
    return null;
  }

  // 2. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–æ–≥–æ –ø–∞—Ä–æ–ª—è
  const { accessLevel } = await attemptAutoLogin();
  if (accessLevel) return accessLevel;

  // 3. –ü–æ–∫–∞–∑ –º–æ–¥–∞–ª–∫–∏ –ø–∞—Ä–æ–ª—è
  return await createLoginModal();
}
```

---

## ‚úÖ –ü–ï–†–ï–í–ê–ì–ò –ù–û–í–û–á –°–ò–°–¢–ï–ú–ò

1. **–ß—ñ—Ç–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞** - –∫–æ–∂–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –º–∞—î —Å–≤—ñ–π guard
2. **–õ–æ–≥—É–≤–∞–Ω–Ω—è** - –≤—Å—ñ –¥—ñ—ó –∑–∞–ø–∏—Å—É—é—Ç—å—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å
3. **–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è** - –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —Ä–æ–∑—É–º—ñ—î —á–æ–º—É –Ω–µ–º–∞—î –¥–æ—Å—Ç—É–ø—É
4. **–ë–µ–∑–ø–µ–∫–∞** -
   - Email –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è –Ω–∞ –∫–ª—ñ—î–Ω—Ç—ñ (–ë–ï–ó –∑–∞–ø–∏—Ç—ñ–≤ –¥–æ –ë–î)
   - –¢–æ–∫–µ–Ω –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ Supabase Auth
   - RLS –∑–∞—Ö–∏—â–∞—î –¥–∞–Ω—ñ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ
5. **UX** - planyvannya.html –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è –±–µ–∑ "–º–∏–≥–æ—Ç—ñ–Ω–Ω—è"

---

## üîí –ë–ï–ó–ü–ï–ö–ê

### –©–æ –∑–∞—Ö–∏—â–µ–Ω–æ:

‚úÖ Google OAuth –æ–±–æ–≤'—è–∑–∫–æ–≤–∏–π
‚úÖ Email whitelist (constants.ts)
‚úÖ Supabase RLS –Ω–∞ –≤—Å—ñ—Ö —Ç–∞–±–ª–∏—Ü—è—Ö
‚úÖ CSP –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≤ HTML
‚úÖ –°–µ—Å—ñ—ó –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å—Å—è –Ω–∞ –∫–æ–∂–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ
‚úÖ –ü–∞—Ä–æ–ª—å –¥–ª—è –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ä–æ–ª—ñ –≤ –±—É—Ö–≥–∞–ª—Ç–µ—Ä—ñ—ó

### –©–æ –ù–ï —Ç—Ä–µ–±–∞ —Ä–æ–±–∏—Ç–∏:

‚ùå –ù–ï –∑–±–µ—Ä—ñ–≥–∞–π—Ç–µ –ø–∞—Ä–æ–ª—ñ –≤ –∫–æ–¥—ñ
‚ùå –ù–ï –¥–æ–¥–∞–≤–∞–π—Ç–µ whitelist —Ç–∞–±–ª–∏—Ü—é –≤ Supabase
‚ùå –ù–ï –∑–º—ñ–Ω—é–π—Ç–µ ALLOWED_EMAILS –±–µ–∑ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

---

## üìä –ü–û–¢–Ü–ö –î–ê–ù–ò–•

```
index.html (login.ts)
    ‚Üì Google OAuth + Whitelist
main.html (main_session_guard.ts)
    ‚Üì –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å–µ—Å—ñ—ó
    ‚îú‚Üí planyvannya.html (–ø–ª–∞–Ω—É–≤–∞–Ω—è_auth_guard.ts)
    ‚îÇ       ‚Üì –ë–ª–æ–∫—É—é—á–∏–π —Å–∫—Ä–∏–ø—Ç + guard
    ‚îÇ       ‚úÖ –î–æ—Å—Ç—É–ø –¥–æ–∑–≤–æ–ª–µ–Ω–æ
    ‚îÇ
    ‚îî‚Üí bukhhalteriya.html (bukhhalteriya_session_guard.ts)
            ‚Üì –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ Google —Å–µ—Å—ñ—ó
            ‚Üì –ú–æ–¥–∞–ª–∫–∞ –ø–∞—Ä–æ–ª—è (users.ts)
            ‚Üì –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ä–æ–ª—ñ
            ‚úÖ –î–æ—Å—Ç—É–ø –¥–æ–∑–≤–æ–ª–µ–Ω–æ
```

---

## üõ†Ô∏è –ü–Ü–î–¢–†–ò–ú–ö–ê

–£—Å—ñ —Ñ–∞–π–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó:

- `constants.ts` - whitelist emails
- `src/ts/vxid/login.ts` - Google OAuth –≤—Ö—ñ–¥
- `src/ts/vxid/supabaseClient.ts` - Supabase –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
- `src/ts/roboha/main_session_guard.ts` - –∑–∞—Ö–∏—Å—Ç main.html
- `src/ts/roboha/planyvannya/planyvannya_auth_guard.ts` - –∑–∞—Ö–∏—Å—Ç planyvannya.html
- `src/ts/roboha/bukhhalteriya/bukhhalteriya_session_guard.ts` - –∑–∞—Ö–∏—Å—Ç bukhhalteriya.html
- `src/ts/roboha/tablucya/users.ts` - —Å–∏—Å—Ç–µ–º–∞ –ø–∞—Ä–æ–ª—ñ–≤ –¥–ª—è —Ä–æ–ª–µ–π

---

**–í–µ—Ä—Å—ñ—è:** 2.0  
**–î–∞—Ç–∞:** 18 –≥—Ä—É–¥–Ω—è 2025  
**–ê–≤—Ç–æ—Ä:** –ê–ª—ñ–º
