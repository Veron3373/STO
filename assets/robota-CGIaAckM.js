import{s as w}from"./supabaseClient-CaENmPBY.js";import{b as h,c as _}from"./main-DcNxIomJ.js";import"./supabase-DjCBILTv.js";import"./pdf-yBvge-Eo.js";let m=[],b=null;const v={Робота:{table:"works",field:"data"}},y=(o,n=!1)=>{if(!o.trim())return;if(!b){h(null);return}const{table:t,field:e,deepPath:d,needsJsonParsing:u}=b;let f=!1;if(m&&m.length>0)for(const a of m){let r=a;if(u&&typeof a[e]=="string")try{r={...a,[e]:JSON.parse(a[e])}}catch{continue}let s;if(d?s=((l,p)=>p.reduce((i,g)=>i&&i[g]!==void 0?i[g]:void 0,l))(r[e],d):(s=u||typeof a[e]=="object"?r[e]:a[e],typeof s=="object"?s=JSON.stringify(s):typeof s!="string"&&(s=String(s))),(s==null?void 0:s.trim())===o.trim()){f=!0;const l=`${t.endsWith("s")?t.slice(0,-1):t}_id`,p=a[l]!==void 0?a[l]:null;let i;if(u&&typeof a[e]=="string")try{i=JSON.parse(a[e])}catch{i=a[e]}else i=a[e];const g={table:t,[l]:p,data:typeof i=="object"&&!Array.isArray(i)?i:{[e]:i}};h(JSON.stringify(g,null,2));return}}if(!f&&n){const r=`${t.endsWith("s")?t.slice(0,-1):t}_id`,s={table:t,[r]:null,data:{[e]:o.trim()}};h(JSON.stringify(s,null,2))}},L=(o,n,t)=>{const e=document.getElementById("custom-dropdown-all_other_bases");if(!e||!t)return;m=o;const d=o.map(r=>{const s=r[n];return s!=null?String(s).trim():null}).filter(r=>typeof r=="string"&&r.length>0),u=[...new Set(d)].sort(),f=r=>{e.innerHTML="";const s=u.filter(c=>c.toLowerCase().includes(r.toLowerCase()));if(s.length===0){e.classList.add("hidden-all_other_bases");return}s.forEach(c=>{const l=document.createElement("div");l.className="custom-dropdown-item",l.textContent=c,l.addEventListener("click",()=>{t.value=c,e.classList.add("hidden-all_other_bases"),y(c,!0)}),e.appendChild(l)}),e.classList.remove("hidden-all_other_bases")};t.addEventListener("input",()=>{f(t.value.trim()),y(t.value.trim(),!1)}),t.addEventListener("focus",()=>{f(t.value.trim())}),document.addEventListener("click",r=>{!e.contains(r.target)&&r.target!==t&&e.classList.add("hidden-all_other_bases")});const a=t.getBoundingClientRect();e.style.minWidth=`${a.width}px`},N=async o=>{const n=v[o];if(n){b=n;try{const t=document.getElementById("search-input-all_other_bases");t&&(t.value=""),h(JSON.stringify({config:n,table:n.table,input:""},null,2)),_(o,n.table);const{data:e,error:d}=await w.from(n.table).select("*");if(d||!e)throw new Error((d==null?void 0:d.message)||"Дані не отримані");L(e,n.field,t)}catch(t){console.error(`Помилка завантаження з ${o}`,t)}}},B=async()=>{await N("Робота")},D=()=>{console.log("Ініціалізовано модуль роботи")};export{B as handleRobotaClick,D as initRobota};
