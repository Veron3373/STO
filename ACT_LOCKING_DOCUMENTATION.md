# –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –∞–∫—Ç—ñ–≤ —á–µ—Ä–µ–∑ Supabase Realtime Presence API

## –û–ø–∏—Å —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—ñ

–†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –º–µ—Ö–∞–Ω—ñ–∑–º –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –∞–∫—Ç—ñ–≤ –ø—Ä–∏ –æ–¥–Ω–æ—á–∞—Å–Ω–æ–º—É —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—ñ —Ä—ñ–∑–Ω–∏–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **Supabase Realtime Presence API**.

## –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î

### 1. –í—ñ–¥–∫—Ä–∏—Ç—Ç—è –∞–∫—Ç—É
–ö–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤—ñ–¥–∫—Ä–∏–≤–∞—î –∞–∫—Ç:
- –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—ñ–¥–ø–∏—Å—É—î—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª Presence –¥–ª—è —Ü—å–æ–≥–æ –∞–∫—Ç—É
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è, —á–∏ —Ö—Ç–æ—Å—å —ñ–Ω—à–∏–π –≤–∂–µ –≤—ñ–¥–∫—Ä–∏–≤ —Ü–µ–π –∞–∫—Ç
- –Ø–∫—â–æ –∞–∫—Ç –≤–∂–µ –≤—ñ–¥–∫—Ä–∏—Ç–∏–π —ñ–Ω—à–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º:
  - –ü–æ–∫–∞–∑—É—î—Ç—å—Å—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è: **"‚ö†Ô∏è –î–∞–Ω–∏–π –∞–∫—Ç –≤—ñ–¥–∫—Ä–∏—Ç–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º: [–ü–Ü–ë]"**
  - –ë–ª–æ–∫—É—î—Ç—å—Å—è –∫–Ω–æ–ø–∫–∞ **"üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏"**
  - –ë–ª–æ–∫—É—é—Ç—å—Å—è –≤—Å—ñ –∫–Ω–æ–ø–∫–∏ –≤ header (üóùÔ∏è, üñ®Ô∏è, ‚úâÔ∏è, üóÇÔ∏è)
  - Header –∑–º—ñ–Ω—é—î –∫–æ–ª—ñ—Ä –Ω–∞ **—á–µ—Ä–≤–æ–Ω–∏–π (#dc3545)**
  - –í—Å—ñ editable –ø–æ–ª—è —Å—Ç–∞—é—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–º–∏ –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è

### 2. –ó–∞–∫—Ä–∏—Ç—Ç—è –∞–∫—Ç—É
–ö–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á (—è–∫–∏–π –ø–µ—Ä—à–∏–π –≤—ñ–¥–∫—Ä–∏–≤ –∞–∫—Ç) –∑–∞–∫—Ä–∏–≤–∞—î –π–æ–≥–æ:
- –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥–ø–∏—Å—É—î—Ç—å—Å—è –≤—ñ–¥ –∫–∞–Ω–∞–ª—É Presence
- –Ü–Ω—à—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ, —è–∫—ñ –º–∞—é—Ç—å –≤—ñ–¥–∫—Ä–∏—Ç–∏–π —Ü–µ–π –∂–µ –∞–∫—Ç, –æ—Ç—Ä–∏–º—É—é—Ç—å:
  - –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è: **"‚úÖ –ê–∫—Ç —Ç–µ–ø–µ—Ä –¥–æ—Å—Ç—É–ø–Ω–∏–π –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è"**
  - –†–æ–∑–±–ª–æ–∫—É–≤–∞–Ω–Ω—è –∫–Ω–æ–ø–∫–∏ **"üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏"**
  - –†–æ–∑–±–ª–æ–∫—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö –∫–Ω–æ–ø–æ–∫ –≤ header
  - –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–ª—å–æ—Ä—É header –Ω–∞ **–∑–µ–ª–µ–Ω–∏–π (#1c4a28)**
  - –†–æ–∑–±–ª–æ–∫—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö editable –ø–æ–ª—ñ–≤

## –ü–µ—Ä–µ–≤–∞–≥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Presence API

‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è** - —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥—Å—Ç–µ–∂—É—î —Ö—Ç–æ –æ–Ω–ª–∞–π–Ω  
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è** - –ø—Ä–∏ –∑–∞–∫—Ä–∏—Ç—Ç—ñ –±—Ä–∞—É–∑–µ—Ä–∞/–≤–∫–ª–∞–¥–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è  
‚úÖ **–†–µ–∞–ª—å–Ω–∏–π —á–∞—Å** - –∑–º—ñ–Ω–∏ –≤—ñ–¥–±—É–≤–∞—é—Ç—å—Å—è –º–∏—Ç—Ç—î–≤–æ –¥–ª—è –≤—Å—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤  
‚úÖ **–ù–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–∏—Å–∞—Ç–∏ –≤ –ë–î** - –Ω–µ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∑–∞–π–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ —É –±–∞–∑—ñ –¥–∞–Ω–∏—Ö  
‚úÖ **–í–∂–µ —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–æ –≤ Supabase** - –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏  

## –¢–µ—Ö–Ω—ñ—á–Ω–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è

### –°—Ç–≤–æ—Ä–µ–Ω—ñ —Ñ–∞–π–ª–∏
- **`src/ts/roboha/zakaz_naraudy/actPresence.ts`** - –º–æ–¥—É–ª—å –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ Presence API

### –ó–º—ñ–Ω–µ–Ω—ñ —Ñ–∞–π–ª–∏
- **`src/ts/roboha/zakaz_naraudy/modalMain.ts`** - –¥–æ–¥–∞–Ω–æ –ø—ñ–¥–ø–∏—Å–∫—É –Ω–∞ Presence –ø—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ –∞–∫—Ç—É
- **`src/ts/roboha/zakaz_naraudy/modalUI.ts`** - –¥–æ–¥–∞–Ω–æ –≤—ñ–¥–ø–∏—Å–∫—É –≤—ñ–¥ Presence –ø—Ä–∏ –∑–∞–∫—Ä–∏—Ç—Ç—ñ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞

### –û—Å–Ω–æ–≤–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó

#### `subscribeToActPresence(actId: number)`
–ü—ñ–¥–ø–∏—Å—É—î—Ç—å—Å—è –Ω–∞ –ø—Ä–∏—Å—É—Ç–Ω—ñ—Å—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞–∫—Ç—É.
- –°—Ç–≤–æ—Ä—é—î –∫–∞–Ω–∞–ª Presence –¥–ª—è –∞–∫—Ç—É
- –í—ñ–¥—Å—Ç–µ–∂—É—î –ø—Ä–∏—î–¥–Ω–∞–Ω–Ω—è/–≤–∏—Ö—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –±–ª–æ–∫—É—î/—Ä–æ–∑–±–ª–æ–∫—É—î —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- –ü–æ–≤–µ—Ä—Ç–∞—î —Å—Ç–∞—Ç—É—Å –±–ª–æ–∫—É–≤–∞–Ω–Ω—è: `{ isLocked: boolean, lockedBy: string | null }`

#### `unsubscribeFromActPresence()`
–í—ñ–¥–ø–∏—Å—É—î—Ç—å—Å—è –≤—ñ–¥ –ø—Ä–∏—Å—É—Ç–Ω–æ—Å—Ç—ñ –∞–∫—Ç—É.
- –í–∏–¥–∞–ª—è—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ –∫–∞–Ω–∞–ª—É Presence
- –û—á–∏—â—É—î –∫–∞–Ω–∞–ª
- –ü–æ–≤—ñ–¥–æ–º–ª—è—î —ñ–Ω—à–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –ø—Ä–æ –≤–∏—Ö—ñ–¥

#### `lockActInterface(lockedByUser: string)`
–ë–ª–æ–∫—É—î —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∞–∫—Ç—É:
- –ü–æ–∫–∞–∑—É—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è
- –ë–ª–æ–∫—É—î –∫–Ω–æ–ø–∫—É "–ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏"
- –ó–º—ñ–Ω—é—î –∫–æ–ª—ñ—Ä header –Ω–∞ —á–µ—Ä–≤–æ–Ω–∏–π
- –ë–ª–æ–∫—É—î –≤—Å—ñ –∫–Ω–æ–ø–∫–∏ –≤ header
- –†–æ–±–∏—Ç—å –≤—Å—ñ –ø–æ–ª—è –Ω–µ—Ä–µ–¥–∞–≥–æ–≤–∞–Ω–∏–º–∏

#### `unlockActInterface()`
–†–æ–∑–±–ª–æ–∫—É—î —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∞–∫—Ç—É:
- –ü–æ–∫–∞–∑—É—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —Ä–æ–∑–±–ª–æ–∫—É–≤–∞–Ω–Ω—è
- –†–æ–∑–±–ª–æ–∫—É—î –∫–Ω–æ–ø–∫—É "–ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏"
- –í—ñ–¥–Ω–æ–≤–ª—é—î –∫–æ–ª—ñ—Ä header
- –†–æ–∑–±–ª–æ–∫—É—î –≤—Å—ñ –∫–Ω–æ–ø–∫–∏ –≤ header
- –†–æ–±–∏—Ç—å –ø–æ–ª—è —Ä–µ–¥–∞–≥–æ–≤–∞–Ω–∏–º–∏ (—è–∫—â–æ –∞–∫—Ç –Ω–µ –∑–∞–∫—Ä–∏—Ç–∏–π)

## –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

```typescript
// –ü—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ –∞–∫—Ç—É
const presenceStatus = await subscribeToActPresence(actId);
if (presenceStatus.isLocked) {
  console.log(`–ê–∫—Ç –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º: ${presenceStatus.lockedBy}`);
} else {
  console.log(`–ê–∫—Ç –¥–æ—Å—Ç—É–ø–Ω–∏–π –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è`);
}

// –ü—Ä–∏ –∑–∞–∫—Ä–∏—Ç—Ç—ñ –∞–∫—Ç—É
await unsubscribeFromActPresence();
```

## –í—ñ–∑—É–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–∏

### –ê–∫—Ç –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∏–π
- üî¥ **–ß–µ—Ä–≤–æ–Ω–∏–π header** (#dc3545)
- üö´ **–ó–∞–±–ª–æ–∫–æ–≤–∞–Ω—ñ –∫–Ω–æ–ø–∫–∏** (opacity: 0.5, cursor: not-allowed)
- üîí **–ù–µ—Ä–µ–¥–∞–≥–æ–≤–∞–Ω—ñ –ø–æ–ª—è** (contentEditable: false, opacity: 0.7)
- ‚ö†Ô∏è **–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è** –ø—Ä–æ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è

### –ê–∫—Ç —Ä–æ–∑–±–ª–æ–∫–æ–≤–∞–Ω–∏–π
- üü¢ **–ó–µ–ª–µ–Ω–∏–π header** (#1c4a28)
- ‚úÖ **–ê–∫—Ç–∏–≤–Ω—ñ –∫–Ω–æ–ø–∫–∏** (opacity: 1, cursor: pointer)
- ‚úèÔ∏è **–†–µ–¥–∞–≥–æ–≤–∞–Ω—ñ –ø–æ–ª—è** (contentEditable: true, opacity: 1)
- ‚úÖ **–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è** –ø—Ä–æ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

–î–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤—ñ–¥–∫—Ä–∏–π—Ç–µ –æ–¥–∏–Ω —ñ —Ç–æ–π –∂–µ –∞–∫—Ç —É –¥–≤–æ—Ö —Ä—ñ–∑–Ω–∏—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö –∞–±–æ –≤–∫–ª–∞–¥–∫–∞—Ö:
1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ –∞–∫—Ç —É –ø–µ—Ä—à–æ–º—É –±—Ä–∞—É–∑–µ—Ä—ñ
2. –í—ñ–¥–∫—Ä–∏–π—Ç–µ —Ç–æ–π –∂–µ –∞–∫—Ç —É –¥—Ä—É–≥–æ–º—É –±—Ä–∞—É–∑–µ—Ä—ñ
3. –î—Ä—É–≥–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø–æ–±–∞—á–∏—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è —Ç–∞ —á–µ—Ä–≤–æ–Ω–∏–π header
4. –ó–∞–∫—Ä–∏–π—Ç–µ –∞–∫—Ç —É –ø–µ—Ä—à–æ–º—É –±—Ä–∞—É–∑–µ—Ä—ñ
5. –î—Ä—É–≥–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø–æ–±–∞—á–∏—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —Ä–æ–∑–±–ª–æ–∫—É–≤–∞–Ω–Ω—è —Ç–∞ –∑–µ–ª–µ–Ω–∏–π header
