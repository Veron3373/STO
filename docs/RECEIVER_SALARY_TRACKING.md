# Система відслідковування зарплати приймальників

## Опис проблеми
Потрібно відслідковувати, який саме приймальник закрив акт, щоб правильно нараховувати йому зарплату.

## Рішення

### 1. Структура даних
Кожен приймальник має поле `Історія` з такою структурою:

```json
{
  "Історія": {
    "2025-12-27": [
      {
        "Акт": "432",
        "Клієнт": "Володимир Сікора",
        "Автомобіль": "Suzuki Grand Vitara",
        "СуммаРоботи": 4800,
        "ЗарплатаРоботи": 2400,
        "СуммаЗапчастин": 4280,
        "ЗарплатаЗапчастин": 1284,
        "ДатаЗакриття": "2025-10-27"
      }
    ]
  }
}
```

### 2. Логіка роботи

#### При збереженні акту (кнопка "Зберегти")
**Файл:** `zberechennya_zmin_y_danux_aktu.ts`, функція `syncPruimalnikHistory`

1. **Видалення з інших приймальників:**
   - Система шукає цей акт в історії ВСІХ інших приймальників
   - Якщо знаходить - видаляє його
   - Це гарантує, що акт може бути тільки в одного приймальника

2. **Додавання/оновлення для поточного приймальника:**
   - Якщо акт вже є в історії - оновлює дані
   - Якщо акту немає - створює новий запис з поточною датою
   - Поле `ДатаЗакриття` встановлюється в `null` (акт ще не закритий)

3. **Розрахунок зарплати:**
   - `СуммаРоботи` = (Сума продажу робіт) - (Зарплата слюсарів)
   - `СуммаЗапчастин` = (Сума продажу запчастин) - (Сума закупки запчастин)
   - `ЗарплатаРоботи` = СуммаРоботи × (ПроцентРоботи / 100)
   - `ЗарплатаЗапчастин` = СуммаЗапчастин × (ПроцентЗапчастин / 100)

#### При закритті акту (кнопка "Замок")
**Файл:** `knopka_zamok.ts`, функція `syncSlyusarsHistoryForAct`

1. Система знаходить акт в історії приймальника
2. Оновлює поле `ДатаЗакриття` на поточну дату
3. Це дозволяє відрізнити закриті акти від відкритих

### 3. Приклад роботи

**Початковий стан:**
- Приймальник "Алім" створив акт #432
- Історія Аліма: `{"2025-12-27": [{"Акт": "432", ..., "ДатаЗакриття": null}]}`

**Приймальник "Петро" відкрив і зберіг акт #432:**
- Історія Аліма: `{"2025-12-27": []}` (акт видалено)
- Історія Петра: `{"2025-12-27": [{"Акт": "432", ..., "ДатаЗакриття": null}]}`

**Петро закрив акт #432:**
- Історія Петра: `{"2025-12-27": [{"Акт": "432", ..., "ДатаЗакриття": "2025-12-27"}]}`
- Зарплата буде нарахована Петру

### 4. Переваги системи
- ✅ Акт завжди належить тільки одному приймальнику
- ✅ Зарплата нараховується тому, хто закрив акт
- ✅ Можна відслідковувати історію переміщення актів між приймальниками
- ✅ Автоматичний розрахунок зарплати на основі відсотків

### 5. Важливі моменти
- Поле `ДатаЗакриття` = `null` означає, що акт ще відкритий
- Поле `ДатаЗакриття` = дата означає, що акт закритий
- При кожному збереженні акт "переїжджає" до того приймальника, який його зберіг
- Зарплата нараховується тільки за закриті акти
