# üîß –ù–ê–õ–ê–ì–û–î–ñ–ï–ù–ù–Ø REALTIME - –ü–û–ö–†–û–ö–û–í–ê –Ü–ù–°–¢–†–£–ö–¶–Ü–Ø

## –ü—Ä–æ–±–ª–µ–º–∞
–ó–º—ñ–Ω–∏ –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö –Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ, –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É.

## ‚úÖ –©–û –í–ñ–ï –ó–†–û–ë–õ–ï–ù–û

1. ‚úÖ –ö–æ–¥ Realtime –ø—ñ–¥–ø–∏—Å–∫–∏ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π
2. ‚úÖ –¢–∞–±–ª–∏—Ü—è `post_arxiv` –¥–æ–¥–∞–Ω–∞ –¥–æ Realtime –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó
3. ‚úÖ REPLICA IDENTITY –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ FULL
4. ‚úÖ –ü–æ–∫—Ä–∞—â–µ–Ω–æ –ª–æ–≥—É–≤–∞–Ω–Ω—è –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

## üîç –î–Ü–ê–ì–ù–û–°–¢–ò–ö–ê (–í–ò–ö–û–ù–ê–ô–¢–ï –ü–û –ü–û–†–Ø–î–ö–£)

### –ö—Ä–æ–∫ 1: –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞

–í—ñ–¥–∫—Ä–∏–π—Ç–µ –ø–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫ —ñ –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å (F12):

**–ú–∞—î –±—É—Ç–∏:**
```
üì° [PostArxiv Realtime] –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—ñ–¥–ø–∏—Å–∫–∏ –Ω–∞ post_arxiv...
üì° [PostArxiv Realtime] –ü–æ—Ç–æ—á–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á: [–≤–∞—à–µ —ñ–º'—è]
üì° [PostArxiv Realtime] –°—Ç–∞—Ç—É—Å –∫–∞–Ω–∞–ª—É: SUBSCRIBED
‚úÖ [PostArxiv Realtime] –ü—ñ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞! –û—á—ñ–∫—É—î–º–æ –ø–æ–¥—ñ—ó –≤—ñ–¥ Supabase...
```

**–Ø–∫—â–æ –±–∞—á–∏—Ç–µ:**
```
üì° [PostArxiv Realtime] –ù–µ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –ø–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫–∞ ‚Äî –ø—ñ–¥–ø–∏—Å–∫—É –Ω–µ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ
```
‚Üí –ü—Ä–æ–±–ª–µ–º–∞: –µ–ª–µ–º–µ–Ω—Ç `postSchedulerWrapper` –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ HTML.

**–Ø–∫—â–æ –±–∞—á–∏—Ç–µ:**
```
üì° [PostArxiv Realtime] –°—Ç–∞—Ç—É—Å –∫–∞–Ω–∞–ª—É: CHANNEL_ERROR
‚ùå [PostArxiv Realtime] –ü–æ–º–∏–ª–∫–∞ –∫–∞–Ω–∞–ª—É!
```
‚Üí –ü—Ä–æ–±–ª–µ–º–∞: RLS –±–ª–æ–∫—É—î –¥–æ—Å—Ç—É–ø. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ –ö—Ä–æ–∫—É 2.

**–Ø–∫—â–æ –Ω—ñ—á–æ–≥–æ –Ω–µ –±–∞—á–∏—Ç–µ:**
‚Üí –ü—Ä–æ–±–ª–µ–º–∞: Realtime –Ω–µ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î—Ç—å—Å—è. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–∏–π —Ñ–∞–π–ª.

### –ö—Ä–æ–∫ 2: –ù–∞–ª–∞—à—Ç—É–π—Ç–µ RLS –ø–æ–ª—ñ—Ç–∏–∫–∏

–í–∏–∫–æ–Ω–∞–π—Ç–µ SQL –∑ —Ñ–∞–π–ª—É `migrations/setup_rls_for_realtime.sql` –≤ Supabase SQL Editor:

```sql
-- –£–≤—ñ–º–∫–Ω—É—Ç–∏ RLS
ALTER TABLE post_arxiv ENABLE ROW LEVEL SECURITY;

-- –ü–æ–ª—ñ—Ç–∏–∫–∞ –¥–ª—è SELECT –¥–ª—è anon (–í–ê–ñ–õ–ò–í–û!)
CREATE POLICY "Enable read access for anon users"
ON post_arxiv
FOR SELECT
TO anon
USING (true);

-- –ü–æ–ª—ñ—Ç–∏–∫–∞ –¥–ª—è SELECT –¥–ª—è authenticated
CREATE POLICY "Enable read access for authenticated users"
ON post_arxiv
FOR SELECT
TO authenticated
USING (true);
```

**–ß–æ–º—É —Ü–µ –≤–∞–∂–ª–∏–≤–æ:**
- –Ø–∫—â–æ –≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ `anon` –∫–ª—é—á (–∑ `.env`) - –ø–æ—Ç—Ä—ñ–±–Ω–∞ –ø–æ–ª—ñ—Ç–∏–∫–∞ –¥–ª—è `anon`
- –ë–µ–∑ –ø–æ–ª—ñ—Ç–∏–∫ RLS –±–ª–æ–∫—É—î –≤—Å—ñ –∑–∞–ø–∏—Ç–∏, –≤–∫–ª—é—á–Ω–æ –∑ Realtime

### –ö—Ä–æ–∫ 3: –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ –ø—Ä–∞—Ü—é—î Realtime

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ –ø–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫ –≤ **–¥–≤–æ—Ö –≤–∫–ª–∞–¥–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞**
2. –í **–ø–µ—Ä—à—ñ–π –≤–∫–ª–∞–¥—Ü—ñ** –≤—ñ–¥–∫—Ä–∏–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å (F12)
3. –í **–¥—Ä—É–≥—ñ–π –≤–∫–ª–∞–¥—Ü—ñ** —Å—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤–µ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è
4. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å –≤ **–ø–µ—Ä—à—ñ–π –≤–∫–ª–∞–¥—Ü—ñ**

**–ú–∞—î –∑'—è–≤–∏—Ç–∏—Å—è:**
```
üì° [PostArxiv Realtime] –ü–æ–¥—ñ—è INSERT: {...}
‚úÖ [PostArxiv Realtime] INSERT - –ù–æ–≤–∏–π –∑–∞–ø–∏—Å: {...}
üì® [PostArxiv Realtime] –ü–æ–∫–∞–∑—É—î–º–æ toast –¥–ª—è INSERT –≤—ñ–¥ [—ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞]
üîÑ [PostArxiv Realtime] –û–Ω–æ–≤–ª—é—é –±–ª–æ–∫–∏ –ø–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫–∞...
```

**–Ø–∫—â–æ –ø–æ–¥—ñ—è –ù–ï –ø—Ä–∏—Ö–æ–¥–∏—Ç—å:**
‚Üí –ü–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ –ö—Ä–æ–∫—É 4

### –ö—Ä–æ–∫ 4: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑ test-realtime.html

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ —Ñ–∞–π–ª `test-realtime.html` –≤ –±—Ä–∞—É–∑–µ—Ä—ñ
2. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è"
3. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–¢–µ—Å—Ç–æ–≤–∏–π INSERT"
4. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ –∑'—è–≤–∏–ª–æ—Å—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–¥—ñ—é

**–Ø–∫—â–æ –ø–æ–¥—ñ—è –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –≤ test-realtime.html, –∞–ª–µ –Ω–µ –≤ –ø–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫—É:**
‚Üí –ü—Ä–æ–±–ª–µ–º–∞ –≤ –∫–æ–¥—ñ –ø–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫–∞. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è `initPostArxivRealtimeSubscription()`

**–Ø–∫—â–æ –ø–æ–¥—ñ—è –ù–ï –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –Ω–∞–≤—ñ—Ç—å –≤ test-realtime.html:**
‚Üí –ü—Ä–æ–±–ª–µ–º–∞ –≤ Supabase. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ –ö—Ä–æ–∫—É 5

### –ö—Ä–æ–∫ 5: –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Supabase

–í–∏–∫–æ–Ω–∞–π—Ç–µ SQL –∑ —Ñ–∞–π–ª—É `migrations/check_realtime_setup.sql`:

```sql
-- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ —Ç–∞–±–ª–∏—Ü—è –≤ –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó
SELECT schemaname, tablename, pubname
FROM pg_publication_tables
WHERE tablename = 'post_arxiv'
  AND pubname = 'supabase_realtime';
```

**–ú–∞—î –ø–æ–≤–µ—Ä–Ω—É—Ç–∏:**
```
schemaname | tablename   | pubname
-----------+-------------+------------------
public     | post_arxiv  | supabase_realtime
```

**–Ø–∫—â–æ –ø–æ—Ä–æ–∂–Ω—å–æ:**
‚Üí –í–∏–∫–æ–Ω–∞–π—Ç–µ:
```sql
ALTER PUBLICATION supabase_realtime ADD TABLE post_arxiv;
ALTER TABLE post_arxiv REPLICA IDENTITY FULL;
```

### –ö—Ä–æ–∫ 6: –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ Network –≤–∫–ª–∞–¥–∫—É

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ DevTools (F12)
2. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ –≤–∫–ª–∞–¥–∫—É **Network**
3. –§—ñ–ª—å—Ç—Ä: **WS** (WebSocket)
4. –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Å—Ç–æ—Ä—ñ–Ω–∫—É

**–ú–∞—î –±—É—Ç–∏:**
- –ó'—î–¥–Ω–∞–Ω–Ω—è –¥–æ `wss://eksifjzzszcqsufwcbsx.supabase.co/realtime/v1/websocket`
- –°—Ç–∞—Ç—É—Å: **101 Switching Protocols** (–∑–µ–ª–µ–Ω–∏–π)

**–Ø–∫—â–æ –∑'—î–¥–Ω–∞–Ω–Ω—è —á–µ—Ä–≤–æ–Ω–µ –∞–±–æ –≤—ñ–¥—Å—É—Ç–Ω—î:**
‚Üí –ü—Ä–æ–±–ª–µ–º–∞ –∑ –º–µ—Ä–µ–∂–µ—é –∞–±–æ Supabase –ø—Ä–æ–µ–∫—Ç –Ω–µ–∞–∫—Ç–∏–≤–Ω–∏–π

### –ö—Ä–æ–∫ 7: –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ API –∫–ª—é—á—ñ

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ñ–∞–π–ª `.env`:

```
VITE_SUPABASE_URL=https://eksifjzzszcqsufwcbsx.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**–í–∞–∂–ª–∏–≤–æ:**
- –ö–ª—é—á –º–∞—î –±—É—Ç–∏ `anon` (–Ω–µ `service_role`)
- URL –º–∞—î –±—É—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º
- –ù–µ–º–∞—î –∑–∞–π–≤–∏—Ö –ø—Ä–æ–±—ñ–ª—ñ–≤

## üéØ –®–í–ò–î–ö–ï –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø

–Ø–∫—â–æ –Ω—ñ—á–æ–≥–æ –Ω–µ –¥–æ–ø–æ–º–∞–≥–∞—î, –≤–∏–∫–æ–Ω–∞–π—Ç–µ –í–°–Ü —Ü—ñ SQL –∫–æ–º–∞–Ω–¥–∏ –≤ Supabase:

```sql
-- 1. –î–æ–¥–∞—Ç–∏ –¥–æ Realtime
ALTER PUBLICATION supabase_realtime ADD TABLE post_arxiv;

-- 2. –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ REPLICA IDENTITY
ALTER TABLE post_arxiv REPLICA IDENTITY FULL;

-- 3. –í–∏–º–∫–Ω—É—Ç–∏ RLS (–¢–Ü–õ–¨–ö–ò –î–õ–Ø –¢–ï–°–¢–£–í–ê–ù–ù–Ø!)
ALTER TABLE post_arxiv DISABLE ROW LEVEL SECURITY;
```

–Ø–∫—â–æ –ø—ñ—Å–ª—è —Ü—å–æ–≥–æ Realtime –∑–∞–ø—Ä–∞—Ü—é—î - –ø—Ä–æ–±–ª–µ–º–∞ –±—É–ª–∞ –≤ RLS.
–¢–æ–¥—ñ –Ω–∞–ª–∞—à—Ç—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ –ø–æ–ª—ñ—Ç–∏–∫–∏ –∑ –ö—Ä–æ–∫—É 2.

## üìù –ß–ï–ö–õ–ò–°–¢

- [ ] –ö–æ–Ω—Å–æ–ª—å –ø–æ–∫–∞–∑—É—î "SUBSCRIBED"
- [ ] RLS –ø–æ–ª—ñ—Ç–∏–∫–∏ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ
- [ ] –¢–∞–±–ª–∏—Ü—è –≤ –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó supabase_realtime
- [ ] REPLICA IDENTITY = FULL
- [ ] WebSocket –∑'—î–¥–Ω–∞–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–µ
- [ ] API –∫–ª—é—á—ñ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ
- [ ] –¢–µ—Å—Ç –≤ test-realtime.html –ø—Ä–∞—Ü—é—î
- [ ] –ü–æ–¥—ñ—ó –ø—Ä–∏—Ö–æ–¥—è—Ç—å –≤ –∫–æ–Ω—Å–æ–ª—å
- [ ] Toast-–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø–æ–∫–∞–∑—É—é—Ç—å—Å—è
- [ ] –ö–∞–ª–µ–Ω–¥–∞—Ä –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ

## üÜò –Ø–ö–©–û –ù–Ü–ß–û–ì–û –ù–ï –î–û–ü–û–ú–ê–ì–ê–Ñ

1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ Supabase –ø—Ä–æ–µ–∫—Ç –∞–∫—Ç–∏–≤–Ω–∏–π
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ —î —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç –∑'—î–¥–Ω–∞–Ω–Ω—è
3. –°–ø—Ä–æ–±—É–π—Ç–µ –≤ —ñ–Ω—à–æ–º—É –±—Ä–∞—É–∑–µ—Ä—ñ
4. –û—á–∏—Å—Ç—ñ—Ç—å –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞ (Ctrl+Shift+Del)
5. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å dev —Å–µ—Ä–≤–µ—Ä (`npm run dev`)

## üìû –ü–Ü–î–¢–†–ò–ú–ö–ê

–Ø–∫—â–æ –ø—Ä–æ–±–ª–µ–º–∞ –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è:
1. –ó—Ä–æ–±—ñ—Ç—å —Å–∫—Ä—ñ–Ω—à–æ—Ç –∫–æ–Ω—Å–æ–ª—ñ –±—Ä–∞—É–∑–µ—Ä–∞
2. –ó—Ä–æ–±—ñ—Ç—å —Å–∫—Ä—ñ–Ω—à–æ—Ç Network –≤–∫–ª–∞–¥–∫–∏ (WebSocket)
3. –°–∫–æ–ø—ñ—é–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç SQL –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫
4. –û–ø–∏—à—ñ—Ç—å —â–æ —Å–∞–º–µ –Ω–µ –ø—Ä–∞—Ü—é—î
