import{s as _}from"./supabaseClient-CaENmPBY.js";import{b as h,c as w}from"./main-DcNxIomJ.js";import"./supabase-DjCBILTv.js";import"./pdf-yBvge-Eo.js";let p=[],m=null;const L={Приймальник:{table:"receivers",field:"data",deepPath:["Name"],needsJsonParsing:!0}},y=(o,t)=>t.reduce((e,s)=>e&&e[s]!==void 0?e[s]:void 0,o),b=(o,t=!1)=>{if(!o.trim())return;if(!m){h(null);return}const{table:e,field:s,deepPath:r,needsJsonParsing:l}=m;let g=!1;if(p&&p.length>0)for(const n of p){let f=n;if(l&&typeof n[s]=="string")try{f={...n,[s]:JSON.parse(n[s])}}catch{continue}let i;if(r?i=y(f[s],r):(i=l||typeof n[s]=="object"?f[s]:n[s],typeof i=="object"?i=JSON.stringify(i):typeof i!="string"&&(i=String(i))),(i==null?void 0:i.trim())===o.trim()){g=!0;const u=`${e.endsWith("s")?e.slice(0,-1):e}_id`,d=n[u]!==void 0?n[u]:null;let c;if(l&&typeof n[s]=="string")try{c=JSON.parse(n[s])}catch{c=n[s]}else c=n[s];const v={table:e,[u]:d,data:r&&r.length===1?{[r[0]]:y(c,r)}:typeof c=="object"&&!Array.isArray(c)?c:{[s]:c}};h(JSON.stringify(v,null,2));return}}if(!g&&t){const f=`${e.endsWith("s")?e.slice(0,-1):e}_id`,i={table:e,[f]:null,data:r&&r.length===1?{[r[0]]:o.trim()}:{[s]:o.trim()}};h(JSON.stringify(i,null,2))}},N=(o,t,e,s,r)=>{const l=document.getElementById("custom-dropdown-all_other_bases");if(!l||!e)return;p=o;const g=o.map(a=>{let u=a;if(r&&typeof a[t]=="string")try{u={...a,[t]:JSON.parse(a[t])}}catch{return null}let d;return s?d=y(r?u[t]:a[t],s):d=r||typeof a[t]=="object"?u[t]:a[t],d!=null?String(d).trim():null}).filter(a=>typeof a=="string"&&a.length>0),n=[...new Set(g)].sort(),f=a=>{l.innerHTML="";const u=n.filter(d=>d.toLowerCase().includes(a.toLowerCase()));if(u.length===0){l.classList.add("hidden-all_other_bases");return}u.forEach(d=>{const c=document.createElement("div");c.className="custom-dropdown-item",c.textContent=d,c.addEventListener("click",()=>{e.value=d,l.classList.add("hidden-all_other_bases"),b(d,!0)}),l.appendChild(c)}),l.classList.remove("hidden-all_other_bases")};e.addEventListener("input",()=>{f(e.value.trim()),b(e.value.trim(),!1)}),e.addEventListener("focus",()=>{f(e.value.trim())}),document.addEventListener("click",a=>{!l.contains(a.target)&&a.target!==e&&l.classList.add("hidden-all_other_bases")});const i=e.getBoundingClientRect();l.style.minWidth=`${i.width}px`},S=async o=>{const t=L[o];if(t){m=t;try{const e=document.getElementById("search-input-all_other_bases");e&&(e.value=""),h(JSON.stringify({config:t,table:t.table,input:""},null,2)),w(o,t.table);const{data:s,error:r}=await _.from(t.table).select("*");if(r||!s)throw new Error((r==null?void 0:r.message)||"Дані не отримані");N(s,t.field,e,t.deepPath,t.needsJsonParsing)}catch(e){console.error(`Помилка завантаження з ${o}`,e)}}},D=async()=>{await S("Приймальник")},P=()=>{console.log("Ініціалізовано модуль приймальника")};export{D as handlePruimalnikClick,P as initPruimalnik};
