import{s as v}from"./supabaseClient-CaENmPBY.js";import{b as h,c as w}from"./main-DcNxIomJ.js";import"./supabase-DjCBILTv.js";import"./pdf-yBvge-Eo.js";let p=[],m=null;const L={Джерело:{table:"incomes",field:"data",deepPath:["Name"],needsJsonParsing:!0}},y=(l,t)=>t.reduce((e,s)=>e&&e[s]!==void 0?e[s]:void 0,l),b=(l,t=!1)=>{if(!l.trim())return;if(!m){h(null);return}const{table:e,field:s,deepPath:r,needsJsonParsing:i}=m;let g=!1;if(p&&p.length>0)for(const n of p){let f=n;if(i&&typeof n[s]=="string")try{f={...n,[s]:JSON.parse(n[s])}}catch{continue}let o;if(r?o=y(f[s],r):(o=i||typeof n[s]=="object"?f[s]:n[s],typeof o=="object"?o=JSON.stringify(o):typeof o!="string"&&(o=String(o))),(o==null?void 0:o.trim())===l.trim()){g=!0;const u=`${e.endsWith("s")?e.slice(0,-1):e}_id`,d=n[u]!==void 0?n[u]:null;let c;if(i&&typeof n[s]=="string")try{c=JSON.parse(n[s])}catch{c=n[s]}else c=n[s];const _={table:e,[u]:d,data:r&&r.length===1?{[r[0]]:y(c,r)}:typeof c=="object"&&!Array.isArray(c)?c:{[s]:c}};h(JSON.stringify(_,null,2));return}}if(!g&&t){const f=`${e.endsWith("s")?e.slice(0,-1):e}_id`,o={table:e,[f]:null,data:r&&r.length===1?{[r[0]]:l.trim()}:{[s]:l.trim()}};h(JSON.stringify(o,null,2))}},N=(l,t,e,s,r)=>{const i=document.getElementById("custom-dropdown-all_other_bases");if(!i||!e)return;p=l;const g=l.map(a=>{let u=a;if(r&&typeof a[t]=="string")try{u={...a,[t]:JSON.parse(a[t])}}catch{return null}let d;return s?d=y(r?u[t]:a[t],s):d=r||typeof a[t]=="object"?u[t]:a[t],d!=null?String(d).trim():null}).filter(a=>typeof a=="string"&&a.length>0),n=[...new Set(g)].sort(),f=a=>{i.innerHTML="";const u=n.filter(d=>d.toLowerCase().includes(a.toLowerCase()));if(u.length===0){i.classList.add("hidden-all_other_bases");return}u.forEach(d=>{const c=document.createElement("div");c.className="custom-dropdown-item",c.textContent=d,c.addEventListener("click",()=>{e.value=d,i.classList.add("hidden-all_other_bases"),b(d,!0)}),i.appendChild(c)}),i.classList.remove("hidden-all_other_bases")};e.addEventListener("input",()=>{f(e.value.trim()),b(e.value.trim(),!1)}),e.addEventListener("focus",()=>{f(e.value.trim())}),document.addEventListener("click",a=>{!i.contains(a.target)&&a.target!==e&&i.classList.add("hidden-all_other_bases")});const o=e.getBoundingClientRect();i.style.minWidth=`${o.width}px`},S=async l=>{const t=L[l];if(t){m=t;try{const e=document.getElementById("search-input-all_other_bases");e&&(e.value=""),h(JSON.stringify({config:t,table:t.table,input:""},null,2)),w(l,t.table);const{data:s,error:r}=await v.from(t.table).select("*");if(r||!s)throw new Error((r==null?void 0:r.message)||"Дані не отримані");N(s,t.field,e,t.deepPath,t.needsJsonParsing)}catch(e){console.error(`Помилка завантаження з ${l}`,e)}}},B=async()=>{await S("Джерело")},j=()=>{console.log("Ініціалізовано модуль джерела")};export{B as handleDhereloClick,j as initDherelo};
