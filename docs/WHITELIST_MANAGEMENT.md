# üîê Whitelist - –ö–µ—Ä—É–≤–∞–Ω–Ω—è –¥–æ—Å—Ç—É–ø–æ–º

## üìã –û–≥–ª—è–¥

–¢–∞–±–ª–∏—Ü—è `whitelist` –∑–±–µ—Ä—ñ–≥–∞—î email –∞–¥—Ä–µ—Å–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —è–∫–∏–º –¥–æ–∑–≤–æ–ª–µ–Ω–æ —É–≤—ñ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É. –í–æ–Ω–∞ –∑–∞—Ö–∏—â–µ–Ω–∞ RLS –ø–æ–ª—ñ—Ç–∏–∫–∞–º–∏ Supabase.

## üõ°Ô∏è –ë–µ–∑–ø–µ–∫–∞

### –©–æ –ú–û–ñ–ù–ê —Ä–æ–±–∏—Ç–∏ —á–µ—Ä–µ–∑ –∫–ª—ñ—î–Ω—Ç:
- ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ **—Ç—ñ–ª—å–∫–∏ —Å–≤—ñ–π email** (–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–∞—á–∏—Ç—å –ª–∏—à–µ —Å–≤—ñ–π –∑–∞–ø–∏—Å)

### –©–æ –ó–ê–ë–û–†–û–ù–ï–ù–û —á–µ—Ä–µ–∑ –∫–ª—ñ—î–Ω—Ç:
- ‚ùå –î–æ–¥–∞–≤–∞—Ç–∏ –Ω–æ–≤—ñ email (INSERT)
- ‚ùå –†–µ–¥–∞–≥—É–≤–∞—Ç–∏ email (UPDATE)
- ‚ùå –í–∏–¥–∞–ª—è—Ç–∏ email (DELETE)
- ‚ùå –ü–µ—Ä–µ–≥–ª—è–¥–∞—Ç–∏ –≤—Å—ñ email –≤ whitelist (–∑–∞—Ö–∏—â–µ–Ω–æ RLS)

## üîß –ö–µ—Ä—É–≤–∞–Ω–Ω—è Whitelist

### 1Ô∏è‚É£ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ

–í–∏–∫–æ–Ω–∞–π—Ç–µ SQL –∑–∞–ø–∏—Ç —É Supabase SQL Editor:

```bash
# –§–∞–π–ª: supabase/create_whitelist_table.sql
```

### 2Ô∏è‚É£ –î–æ–¥–∞–≤–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

**–ß–µ—Ä–µ–∑ Supabase SQL Editor:**

```sql
INSERT INTO whitelist (email, comment)
VALUES ('newuser@gmail.com', '–ù–æ–≤–∏–π –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫');
```

**–ß–µ—Ä–µ–∑ Supabase Dashboard:**
1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ Table Editor
2. –í–∏–±–µ—Ä—ñ—Ç—å —Ç–∞–±–ª–∏—Ü—é `whitelist`
3. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "Insert row"
4. –í–≤–µ–¥—ñ—Ç—å email —Ç–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä
5. –ó–±–µ—Ä–µ–∂—ñ—Ç—å

### 3Ô∏è‚É£ –í–∏–¥–∞–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

```sql
DELETE FROM whitelist
WHERE email = 'user@gmail.com';
```

### 4Ô∏è‚É£ –ü–µ—Ä–µ–≥–ª—è–¥ –≤—Å—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

```sql
SELECT * FROM whitelist
ORDER BY created_at DESC;
```

### 5Ô∏è‚É£ –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∫–æ–º–µ–Ω—Ç–∞—Ä—è

```sql
UPDATE whitelist
SET comment = '–û–Ω–æ–≤–ª–µ–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä'
WHERE email = 'user@gmail.com';
```

## üîç –Ø–∫ –ø—Ä–∞—Ü—é—î –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞

1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤—Ö–æ–¥–∏—Ç—å —á–µ—Ä–µ–∑ Google OAuth
2. –°–∏—Å—Ç–µ–º–∞ –æ—Ç—Ä–∏–º—É—î email –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
3. –í–∏–∫–æ–Ω—É—î—Ç—å—Å—è –∑–∞–ø–∏—Ç –¥–æ `whitelist`:
   ```typescript
   const { data } = await supabase
     .from("whitelist")
     .select("email")
     .eq("email", userEmail)
     .single();
   ```
4. –ó–∞–≤–¥—è–∫–∏ RLS –ø–æ–ª—ñ—Ç–∏—Ü—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–∞—á–∏—Ç—å **—Ç—ñ–ª—å–∫–∏ —Å–≤—ñ–π email**
5. –Ø–∫—â–æ `data` —ñ—Å–Ω—É—î ‚Üí –¥–æ—Å—Ç—É–ø –¥–æ–∑–≤–æ–ª–µ–Ω–æ ‚úÖ
6. –Ø–∫—â–æ `data = null` ‚Üí –¥–æ—Å—Ç—É–ø –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ ‚ùå

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ñ

```sql
CREATE TABLE whitelist (
  id BIGSERIAL PRIMARY KEY,
  email TEXT NOT NULL UNIQUE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  comment TEXT
);
```

| –ö–æ–ª–æ–Ω–∫–∞ | –¢–∏–ø | –û–ø–∏—Å |
|---------|-----|------|
| `id` | BIGSERIAL | –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä |
| `email` | TEXT | Email –∞–¥—Ä–µ—Å–∞ (—É–Ω—ñ–∫–∞–ª—å–Ω–∞) |
| `created_at` | TIMESTAMP | –î–∞—Ç–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è |
| `comment` | TEXT | –û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä |

## üîí RLS –ü–æ–ª—ñ—Ç–∏–∫–∏

### –ü–æ–ª—ñ—Ç–∏–∫–∞ —á–∏—Ç–∞–Ω–Ω—è
```sql
-- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–∞—á–∏—Ç—å –¢–Ü–õ–¨–ö–ò —Å–≤—ñ–π email
CREATE POLICY "whitelist_check_own_email"
ON whitelist FOR SELECT
TO authenticated
USING (email = auth.jwt()->>'email');
```

### –ü–æ–ª—ñ—Ç–∏–∫–∏ –∑–∞–±–æ—Ä–æ–Ω–∏
```sql
-- INSERT –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ
CREATE POLICY "whitelist_no_insert"
ON whitelist FOR INSERT
WITH CHECK (false);

-- UPDATE –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ
CREATE POLICY "whitelist_no_update"
ON whitelist FOR UPDATE
USING (false);

-- DELETE –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ
CREATE POLICY "whitelist_no_delete"
ON whitelist FOR DELETE
USING (false);
```

## ‚ö†Ô∏è –í–∞–∂–ª–∏–≤–æ

- –í—Å—ñ –∑–º—ñ–Ω–∏ –≤ whitelist –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è **—Ç—ñ–ª—å–∫–∏ —á–µ—Ä–µ–∑ Supabase Dashboard** –∞–±–æ **SQL Editor**
- –ù—ñ–∫–æ–ª–∏ –Ω–µ –¥–∞–≤–∞–π—Ç–µ Service Role Key –∫–ª—ñ—î–Ω—Ç—Å—å–∫–æ–º—É –∫–æ–¥—É
- RLS –ø–æ–ª—ñ—Ç–∏–∫–∏ –∑–∞—Ö–∏—â–∞—é—Ç—å –≤—ñ–¥ –Ω–µ—Å–∞–Ω–∫—Ü—ñ–æ–Ω–æ–≤–∞–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –Ω–µ –º–æ–∂—É—Ç—å –ø–æ–±–∞—á–∏—Ç–∏ —Å–ø–∏—Å–æ–∫ –≤—Å—ñ—Ö email –∞–¥—Ä–µ—Å

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ RLS –ø—Ä–∞—Ü—é—î:

```sql
-- 1. –°–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–¥–∞—Ç–∏ email —á–µ—Ä–µ–∑ –∫–ª—ñ—î–Ω—Ç (–º–∞—î –±—É—Ç–∏ –ø–æ–º–∏–ª–∫–∞)
-- 2. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ –í–°–Ü email (–º–∞—î –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ —Ç—ñ–ª—å–∫–∏ –≤–∞—à)
-- 3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –Ω–µ –º–∞—é—Ç—å –¥–æ—Å—Ç—É–ø—É
```

## üìù –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

```typescript
// –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ email —á–µ—Ä–µ–∑ –±–∞–∑—É –¥–∞–Ω–∏—Ö
async function isEmailAllowed(email: string): Promise<boolean> {
  const { data, error } = await supabase
    .from("whitelist")
    .select("email")
    .eq("email", email.toLowerCase())
    .single();

  return !!data;
}
```

## üÜò –ü—ñ–¥—Ç—Ä–∏–º–∫–∞

–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–¥–∞—Ç–∏/–≤–∏–¥–∞–ª–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:
1. –ó–∞–π–¥—ñ—Ç—å –≤ Supabase Dashboard
2. Table Editor ‚Üí whitelist
3. –í–∏–∫–æ–Ω–∞–π—Ç–µ –ø–æ—Ç—Ä—ñ–±–Ω—É –æ–ø–µ—Ä–∞—Ü—ñ—é
4. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ–¥—Ä–∞–∑—É –æ—Ç—Ä–∏–º–∞—î/–≤—Ç—Ä–∞—Ç–∏—Ç—å –¥–æ—Å—Ç—É–ø
